---
// filepath: /workspaces/blogv2/src/components/mdx/ImageZoom.astro
import { Image } from 'astro:assets';

export interface Props {
  src: string;
  alt: string;
  class?: string;
}

let { src, alt } = Astro.props;
---

<div class="image-zoom-container">
  <Image src={src} alt={alt} class="zoomable-image"/>
</div>

<style>
  .image-zoom-container {
    position: relative;
    display: inline-block;
    cursor: zoom-in;
    margin: 0;
    padding: 0;
  }

  .zoomable-image {
    width: 100%;
    transition: transform 0.25s ease;
  }

  /* Add hover scaling behavior, only when not zoomed */
  .image-zoom-container:hover .zoomable-image:not([data-zoomed="true"]) {
    transform: scale(1.05);
  }

  .zoomable-image[data-zoomed="true"] {
    transform: scale(1.5) !important;
    cursor: zoom-out;
  }
</style>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    let containers = document.querySelectorAll('.image-zoom-container');
    containers.forEach(container => {
      let isZoomed = false;

      function toggleZoom(event) {
        let currentTarget = event.currentTarget;
        let img = currentTarget.querySelector('img');

        isZoomed = !isZoomed;
        if (isZoomed) {
          img.setAttribute('data-zoomed', 'true');
          img.classList.add('zoomed');
        } else {
          img.removeAttribute('data-zoomed');
          img.classList.remove('zoomed');
        }
      }

      function unzoom() {
        let img = container.querySelector('img');
        if (img && isZoomed) {
          isZoomed = false;
          img.removeAttribute('data-zoomed');
          img.classList.remove('zoomed');
        }
      }

      container.addEventListener('click', toggleZoom);

      container.addEventListener('mouseleave', () => {
        if (!isZoomed) {
          let img = container.querySelector('img');
          if (img) {
            img.removeAttribute('data-zoomed');
            img.classList.remove('zoomed');
          }
        } else {
          unzoom();
        }
      });

      window.addEventListener('resize', unzoom);
      document.addEventListener('click', (event) => {
        if (!container.contains(event.target) && isZoomed) {
          unzoom();
        }
      });
    });
  });
</script>

<style>
  .zoomed {
    z-index: 1000; /* Ensure it is on top of other elements */
    position: relative; /* Ensure z-index works */
  }
</style>